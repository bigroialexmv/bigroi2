SELECT * FROM PURCHASE_ORDER;

SELECT * FROM PURCHASE_ORDER_PRODUCT;

SELECT PO.USER_ID, U.LAST_NAME, POP.ORDER_ID as ORDR, POP.PRODUCT_CODE, P.NAME 
	FROM PURCHASE_ORDER_PRODUCT as POP
		INNER JOIN PRODUCT as P ON POP.PRODUCT_CODE=P.CODE
		INNER JOIN PURCHASE_ORDER as PO ON POP.ORDER_ID=PO.ORDER_ID
		inner join USER as U on PO.USER_ID=U.USER_ID
;

select POP.ORDER_ID, POP.PRODUCT_CODE, 
	POP.DISCOUNT, POP.PRODUCT_QUANTITY, POP.PRODUCT_PRICE,
	POP.PRODUCT_QUANTITY * POP.PRODUCT_PRICE * (1 - POP.DISCOUNT / 100) as TOTAL_PRICE
	FROM PURCHASE_ORDER_PRODUCT as POP		
;

select SUM(POP.PRODUCT_QUANTITY * POP.PRODUCT_PRICE * (1 - POP.DISCOUNT / 100)) as TOTAL_PRICE
	FROM PURCHASE_ORDER_PRODUCT as POP		
;

-- �������� ������ � ������ � �����������
select 
	SUM(POP.PRODUCT_QUANTITY * POP.PRODUCT_PRICE * (1 - POP.DISCOUNT / 100)) as TOTAL_PRICE,
	POP.ORDER_ID,
	U.LAST_NAME
		FROM PURCHASE_ORDER_PRODUCT as POP
			INNER JOIN PURCHASE_ORDER as PO ON POP.ORDER_ID=PO.ORDER_ID
			inner join USER as U on PO.USER_ID=U.USER_ID
	group by POP.ORDER_ID
union
	select SUM(POP.PRODUCT_QUANTITY * POP.PRODUCT_PRICE * (1 - POP.DISCOUNT / 100)) as TOTAL_PRICE,
	'TOTAL' as TOTAL_PRICE,
	'-'
	FROM PURCHASE_ORDER_PRODUCT as POP
;

-- �������� ���� ��������� ������� �� �������
select 
	MAX(POP.PRODUCT_QUANTITY * POP.PRODUCT_PRICE * (1 - POP.DISCOUNT / 100)) as MAX_PRICE,
	POP.ORDER_ID, POP.PRODUCT_CODE, P.NAME,
	U.LAST_NAME
		FROM PURCHASE_ORDER_PRODUCT as POP
			INNER JOIN purchase_order as PO ON POP.ORDER_ID=PO.ORDER_ID
			inner join user as U on PO.USER_ID=U.USER_ID
			inner join product as P on POP.PRODUCT_CODE=P.CODE
	group by POP.ORDER_ID
union
	select SUM(POP.PRODUCT_QUANTITY * POP.PRODUCT_PRICE * (1 - POP.DISCOUNT / 100)) as TOTAL_PRICE,
	'TOTAL',
	'-','-',
	'-'
	FROM PURCHASE_ORDER_PRODUCT as POP
;

select * from PURCHASE_ORDER_PRODUCT;

-- ������ 
select SUM(PRODUCT_QUANTITY), ORDER_ID from PURCHASE_ORDER_PRODUCT
group by ORDER_ID
having SUM(PRODUCT_QUANTITY) >= 3 
 -- and ORDER_ID > 30
order by ORDER_ID DESC
;
